local TweenService = game:GetService("TweenService")
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")
local backpack = player:WaitForChild("Backpack")

-- Các đảo và NPC
local sea1Island = workspace:WaitForChild("Sea1Island")  
local sea2Island = workspace:WaitForChild("Sea2Island")  
local sea3Island = workspace:WaitForChild("Sea3Island")  

-- Các trái cây
local fruitFolder = workspace:WaitForChild("Fruits")
local fruits = fruitFolder:GetChildren()

local haki = player:WaitForChild("Haki")

-- Các tham số level và điều kiện
local maxLevel = 2600
local currentLevel = player.leaderstats.Level.Value

-- Trạng thái bật/tắt các tính năng
local autoQuestEnabled = false
local autoMeleeEnabled = false
local showFPS = false
local antiBanEnabled = true
local espEnabled = false
local tweenToFruitEnabled = false
local fastAttackEnabled = false

-- Delay ngẫu nhiên (Anti-ban)
local function randomDelay(min, max)
    local delayTime = math.random(min, max)
    wait(delayTime)
end

-- Kiểm tra xem đã đạt đủ level chưa
local function isLevelMax()
    return currentLevel >= maxLevel
end

-- Bật Haki nếu chưa mua
local function enableHaki()
    if not haki.Value then
        haki.Value = true
        print("Haki đã được bật!")
    end
end

-- Kiểm tra và chọn vũ khí melee
local function selectMeleeWeapon()
    local meleeWeapon = nil
    for _, item in pairs(backpack:GetChildren()) do
        if item:IsA("Tool") and item.Name:lower():find("sword") then
            meleeWeapon = item
            break
        end
    end

    if meleeWeapon then
        print("Đã chọn vũ khí melee: " .. meleeWeapon.Name)
        character.Humanoid:EquipTool(meleeWeapon)
    else
        print("Không có vũ khí melee trong balo!")
    end
end

-- Anti-Ban: Đánh nhanh với độ trễ ngẫu nhiên
local function fastAttackMonster(monster)
    selectMeleeWeapon()

    -- Kiểm tra khoảng cách từ quái vật
    local distance = (monster.Position - rootPart.Position).magnitude

    if distance <= 10 then
        local monsterHumanoid = monster:FindFirstChildOfClass("Humanoid")
        if monsterHumanoid and monsterHumanoid.Health > 0 then
            -- Tấn công quái vật, giảm thời gian giữa các lần tấn công nếu Fast Attack được bật
            while fastAttackEnabled and monsterHumanoid.Health > 0 do
                -- Đánh quái vật và tạo độ trễ ngẫu nhiên giữa các lần tấn công để tránh bị phát hiện
                monsterHumanoid:TakeDamage(10)  -- Tùy chỉnh lượng sát thương
                randomDelay(0.05, 0.1)  -- Tạo độ trễ ngẫu nhiên để tránh tấn công quá nhanh
            end
        end
    end
end

-- ESP Fruit: Hiển thị các trái cây trên bản đồ
local function displayFruitESP()
    if espEnabled then
        for _, fruit in pairs(fruits) do
            -- Tạo một ESP cho mỗi trái cây
            local fruitLabel = Instance.new("BillboardGui")
            fruitLabel.Adornee = fruit
            fruitLabel.Parent = fruit
            fruitLabel.Size = UDim2.new(0, 100, 0, 50)
            fruitLabel.StudsOffset = Vector3.new(0, 5, 0)

            local textLabel = Instance.new("TextLabel")
            textLabel.Parent = fruitLabel
            textLabel.Text = fruit.Name
            textLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
            textLabel.BackgroundTransparency = 0.5
            textLabel.Size = UDim2.new(1, 0, 1, 0)
            textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            textLabel.TextSize = 16
            textLabel.TextStrokeTransparency = 0.8
        end
    else
        -- Xóa ESP khi tắt
        for _, fruit in pairs(fruits) do
            local fruitLabel = fruit:FindFirstChildOfClass("BillboardGui")
            if fruitLabel then
                fruitLabel:Destroy()
            end
        end
    end
end

-- Di chuyển đến trái cây đã tìm thấy
local function moveToFruit(fruit)
    local targetPosition = fruit.Position
    local tweenInfo = TweenInfo.new(5, Enum.EasingStyle.Linear, Enum.EasingDirection.Out, 1, false, 0)
    local tweenGoal = {Position = targetPosition}
    local tween = TweenService:Create(rootPart, tweenInfo, tweenGoal)
    tween:Play()
    print("Đang di chuyển đến trái cây: " .. fruit.Name)
end

-- Tạo Menu UI với khóa mật khẩu
local function createMenu()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Parent = player.PlayerGui

    -- Tạo Menu chính
    local menuFrame = Instance.new("Frame")
    menuFrame.Parent = screenGui
    menuFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    menuFrame.BackgroundTransparency = 0.5
    menuFrame.Size = UDim2.new(0, 200, 0, 500)
    menuFrame.Position = UDim2.new(1, -220, 0, 10)
    menuFrame.AnchorPoint = Vector2.new(1, 0)

    -- Thêm một ô nhập mật khẩu khi người chơi nhấn vào menu
    local passwordLabel = Instance.new("TextLabel")
    passwordLabel.Parent = menuFrame
    passwordLabel.Text = "Nhập mật khẩu để mở menu:"
    passwordLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    passwordLabel.Size = UDim2.new(0, 180, 0, 30)
    passwordLabel.Position = UDim2.new(0, 10, 0, 10)

    local passwordBox = Instance.new("TextBox")
    passwordBox.Parent = menuFrame
    passwordBox.Size = UDim2.new(0, 180, 0, 30)
    passwordBox.Position = UDim2.new(0, 10, 0, 50)
    passwordBox.Text = ""
    passwordBox.PlaceholderText = "Nhập mật khẩu"
    passwordBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    passwordBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)

    local enterButton = Instance.new("TextButton")
    enterButton.Parent = menuFrame
    enterButton.Text = "Enter"
    enterButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    enterButton.Size = UDim2.new(0, 180, 0, 30)
    enterButton.Position = UDim2.new(0, 10, 0, 90)
    enterButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

    enterButton.MouseButton1Click:Connect(function()
        -- Kiểm tra mật khẩu
        if passwordBox.Text == "123" then
            print("Mật khẩu đúng! Mở menu.")
            -- Hiển thị menu (các nút bật/tắt các tính năng khác)
            -- Thêm các tính năng UI khác ở đây (ESP, Fast Attack, Auto Quest, ...)
        else
            print("Mật khẩu sai! Thử lại.")
        end
    end)
end

-- Hiển thị menu khi người chơi nhấn phím "M" (hoặc phím khác bạn chọn)
game:GetService("UserInputService").InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.M then  -- Bạn có thể thay đổi phím này
        createMenu()  -- Hiển thị menu khi nhấn phím M
    end
end)
